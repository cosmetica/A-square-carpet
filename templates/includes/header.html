{% load wagtailsettings_tags static wagtailcore_tags nav_extras %} {# เพิ่ม nav_extras #}
{% get_settings use_default_site=True %}

<header class="w-full sticky top-0 z-50">
  <div class="bg-gradient-to-r from-navy to-sky text-white">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between max-w-screen-xl">
      <a href="/" class="flex items-center gap-2 font-semibold tracking-wide">
        <img src="{% static 'asquare_carpets/logo.svg' %}" alt="{{ settings.asquare_carpets.CompanySettings.brand_name }}" class="h-8 w-auto" />
        <span>{{ settings.asquare_carpets.CompanySettings.brand_name }}</span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm relative">
        <a class="hover:underline" href="/">Home</a>
        <a class="hover:underline" href="/services/">Services</a>

        {# ---------- Products mega menu ---------- #}
        {% products_index as prod_index %}
        <div class="relative group">
          <a href="{{ prod_index.url|default:'/products/' }}" class="inline-flex items-center gap-1">
            Products
            <svg class="w-4 h-4 opacity-80" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 0 1 1.08 1.04l-4.25 4.25a.75.75 0 0 1-1.08 0L5.25 8.27a.75.75 0 0 1-.02-1.06z"/></svg>
          </a>

          {# แก้: เอา mt-3 ออก, ใช้ top-full + pt-3 แทน, ใส่ z-50 กันโดนบัง #}
          <div class="absolute left-0 top-full w-[72rem] max-w-[90vw] z-50">
            <div class="pt-3">  {# ระยะห่างด้านในแทน #}
              <div class="rounded-2xl bg-white/95 text-slate-900 shadow-lg ring-1 ring-black/5 p-6
                          opacity-0 invisible translate-y-2
                          group-hover:opacity-100 group-hover:visible group-hover:translate-y-0 transition">
                <div class="mb-4">
                  <a href="{{ prod_index.url|default:'/products/' }}" class="font-semibold text-sm text-navy underline">All Products</a>
                </div>

                {% product_columns 2 as cols %}
                <div class="grid md:grid-cols-3 gap-8">
                  {% for col in cols %}
                    <div class="space-y-3">
                      {% for p in col %}
                        <a href="{{ p.url }}" class="block text-base hover:text-navy">{{ p.title }}</a>
                      {% endfor %}
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>

        {# ---------- /Products mega menu ---------- #}

        <a class="hover:underline" href="/gallery/">Gallery</a>
        <a class="hover:underline" href="/about/">About</a>
        <a class="hover:underline" href="/contact/">Contact</a>
      </nav>

      <a href="/contact/" class="md:inline-flex hidden rounded-xl bg-white/90 text-navy px-4 py-2 font-semibold shadow hover:bg-white">
        Get a Quote
      </a>
    </div>
  </div>
</header>
